<div id="qcard-{{ q.id }}" class="border rounded-2xl p-4 bg-white">
    <div class="flex items-start justify-between gap-3">
        <div>
            <div class="text-sm font-semibold">{{ q.order }}. {{ q.prompt }}</div>
            <div class="text-xs text-gray-500 mt-1">Ұпай: {{ q.points }}</div>
        </div>

        {% if saved %}
            <span class="text-xs px-2 py-1 rounded-full bg-green-50 border border-green-200 text-green-700">
                Сақталды ✅
            </span>
        {% endif %}
    </div>

    <div class="mt-4">
        {% if q.question_type == "mcq_single" %}
        <form 
            hx-post="{% url 'main:attempt_answer' attempt.id q.id %}" 
            hx-target="#qcard-{{ q.id }}"
            hx-swap="outerHTML"
        >
            {% csrf_token %}
            <div class="space-y-2">
                {% for opt in q.options.all %}
                    <label
                        class="flex items-start gap-3 p-3 rounded-xl border cursor-pointer {% if opt.id in selected_set %} bg-gray-50{% endif %}">
                        <input 
                            type="radio" 
                            name="option" 
                            value="{{ opt.id }}" 
                            {% if opt.id in selected_set %}checked{% endif %} 
                            class="mt-1"
                        >
                        <div class="text-sm">{{ opt.text }}</div>
                    </label>
                {% endfor %}
            </div>

            <button type="submit" class="mt-3 px-4 py-2 rounded-xl bg-gray-900 text-white text-sm font-medium">
                Жауапты сақтау
            </button>
        </form>

        {% elif q.question_type == "mcq_multi" %}
        <form hx-post="{% url 'main:attempt_answer' attempt.id q.id %}" hx-target="#qcard-{{ q.id }}"
            hx-swap="outerHTML">
            {% csrf_token %}
            <div class="space-y-2">
                {% for opt in q.options.all %}
                <label
                    class="flex items-start gap-3 p-3 rounded-xl border cursor-pointer {% if opt.id in selected_set %} bg-gray-50{% endif %}">
                    <input 
                        type="checkbox" 
                        name="options" 
                        value="{{ opt.id }}" 
                        {% if opt.id in selected_set %}checked{% endif %} 
                        class="mt-1"
                    >
                    <div class="text-sm">{{ opt.text }}</div>
                </label>
                {% endfor %}
            </div>

            <button type="submit" class="mt-3 px-4 py-2 rounded-xl bg-gray-900 text-white text-sm font-medium">
                Жауапты сақтау
            </button>
        </form>
        {% endif %}
    </div>
</div>